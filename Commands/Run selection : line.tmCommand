<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
	<key>beforeRunningCommand</key>
	<string>saveActiveFile</string>
	<key>command</key>
	<string>#!/bin/bash

if [[ -z $TM_IPYTHON ]]; then
	CMD='ipython'
else
	CMD=$TM_IPYTHON
fi

if [[ -z $TM_SELECTED_TEXT ]]; then
	TEXT="$TM_CURRENT_LINE"
else
	TEXT="$TM_SELECTED_TEXT"
fi 
   
osascript &lt;&lt;- APPLESCRIPT
        tell application "Terminal"
                set currentTab to (selected tab of (get first window))
                set tabProcs to processes of currentTab
                set theProc to (end of tabProcs)
                if theProc is not "Python" then
                        set currentTab to (do script "$CMD")
                end if
                
                do script "$TEXT\n" in currentTab
        end tell
APPLESCRIPT</string>
	<key>fallbackInput</key>
	<string>document</string>
	<key>input</key>
	<string>none</string>
	<key>name</key>
	<string>Run selection / line</string>
	<key>output</key>
	<string>discard</string>
	<key>scope</key>
	<string>source.python</string>
	<key>uuid</key>
	<string>E33D56E8-D391-4788-A699-7371B22E0E67</string>
</dict>
</plist>
